<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      th:replace="~{layout/base-layout :: layout(~{::title}, ~{::content})}">
<head>
    <title>Tài khoản - 2BSHOP</title>
</head>
<body>
    <div th:fragment="content">
        <!-- Not Logged In -->
        <section class="auth-section" sec:authorize="!isAuthenticated()">
            <div class="container">
                <div class="auth-container">
                    <!-- Login Form -->
                    <div class="auth-box">
                        <h2>ĐĂNG NHẬP</h2>
                        <p class="auth-subtitle">Chào mừng bạn quay trở lại!</p>

                        <form th:action="@{/login}" method="post" class="auth-form">
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" name="username" required placeholder="example@email.com">
                            </div>

                            <div class="form-group">
                                <label>Mật khẩu</label>
                                <input type="password" name="password" required placeholder="Nhập mật khẩu">
                            </div>

                            <div class="form-options">
                                <label class="checkbox">
                                    <input type="checkbox" name="remember-me">
                                    <span>Ghi nhớ đăng nhập</span>
                                </label>
                                <a href="/forgot-password" class="link">Quên mật khẩu?</a>
                            </div>

                            <button type="submit" class="btn btn-primary btn-lg btn-block">
                                ĐĂNG NHẬP
                            </button>

                            <div class="auth-divider">
                                <span>hoặc</span>
                            </div>

                            <button type="button" class="btn btn-outline btn-block">
                                <i class="fab fa-google"></i>
                                Đăng nhập với Google
                            </button>
                        </form>

                        <p class="auth-footer">
                            Chưa có tài khoản? <a href="#register" onclick="switchToRegister()">Đăng ký ngay</a>
                        </p>
                    </div>

                    <!-- Register Form -->
                    <div class="auth-box" id="registerBox" style="display: none;">
                        <h2>ĐĂNG KÝ</h2>
                        <p class="auth-subtitle">Tạo tài khoản mới</p>

                        <form th:action="@{/register}" method="post" class="auth-form">
                            <div class="form-group">
                                <label>Họ và tên</label>
                                <input type="text" name="fullName" required placeholder="Nguyễn Văn A">
                            </div>

                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" name="email" required placeholder="example@email.com">
                            </div>

                            <div class="form-group">
                                <label>Số điện thoại</label>
                                <input type="tel" name="phone" required placeholder="0912345678">
                            </div>

                            <div class="form-group">
                                <label>Mật khẩu</label>
                                <input type="password" name="password" required placeholder="Tối thiểu 6 ký tự">
                            </div>

                            <div class="form-group">
                                <label>Xác nhận mật khẩu</label>
                                <input type="password" name="confirmPassword" required placeholder="Nhập lại mật khẩu">
                            </div>

                            <label class="checkbox">
                                <input type="checkbox" required>
                                <span>Tôi đồng ý với <a href="/terms">Điều khoản dịch vụ</a></span>
                            </label>

                            <button type="submit" class="btn btn-primary btn-lg btn-block">
                                ĐĂNG KÝ
                            </button>
                        </form>

                        <p class="auth-footer">
                            Đã có tài khoản? <a href="#login" onclick="switchToLogin()">Đăng nhập</a>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Logged In - User Dashboard -->
        <section class="profile-section" sec:authorize="isAuthenticated()">
            <div class="container">
                <div class="profile-grid">
                    <!-- Sidebar -->
                    <div class="profile-sidebar">
                        <div class="profile-header">
                            <div class="profile-avatar">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <h3 sec:authentication="principal.fullName">User Name</h3>
                            <p sec:authentication="principal.username">user@email.com</p>
                        </div>

                        <nav class="profile-menu">
                            <a href="#" class="menu-item active" onclick="showTab('orders')">
                                <i class="fas fa-box"></i>
                                <span>Đơn hàng của tôi</span>
                            </a>
                            <a href="#" class="menu-item" onclick="showTab('profile')">
                                <i class="fas fa-user"></i>
                                <span>Thông tin cá nhân</span>
                            </a>
                            <a href="#" class="menu-item" onclick="showTab('address')">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>Địa chỉ giao hàng</span>
                            </a>
                            <a href="#" class="menu-item" onclick="showTab('password')">
                                <i class="fas fa-lock"></i>
                                <span>Đổi mật khẩu</span>
                            </a>
                            <a href="/logout" class="menu-item">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Đăng xuất</span>
                            </a>
                        </nav>
                    </div>

                    <!-- Main Content -->
                    <div class="profile-content">
                        <!-- Orders Tab -->
                        <div class="tab-content active" id="orders-tab">
                            <h2>ĐƠN HÀNG CỦA TÔI</h2>
                            
                            <!-- Order Filters -->
                            <div class="order-filters">
                                <button class="filter-btn active">Tất cả</button>
                                <button class="filter-btn">Chờ xác nhận</button>
                                <button class="filter-btn">Đang giao</button>
                                <button class="filter-btn">Đã giao</button>
                                <button class="filter-btn">Đã hủy</button>
                            </div>

                            <!-- Orders List -->
                            <div class="orders-list" th:if="${orders != null and !orders.isEmpty()}">
                                <div class="order-card" th:each="order : ${orders}">
                                    <div class="order-header">
                                        <div class="order-info">
                                            <span class="order-id">Đơn hàng #<span th:text="${order.orderId}">12345</span></span>
                                            <span class="order-date" th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy HH:mm')}">01/01/2024 10:00</span>
                                        </div>
                                        <span class="order-status" th:text="${order.orderStatus}" 
                                              th:classappend="${order.orderStatus == 'COMPLETED' ? 'status-completed' : 
                                                             order.orderStatus == 'CANCELLED' ? 'status-cancelled' : 'status-pending'}">
                                            Đang xử lý
                                        </span>
                                    </div>

                                    <div class="order-body">
                                        <div class="order-items">
                                            <div class="order-item" th:each="detail : ${order.orderDetails}">
                                                <img th:src="${detail.watch.images != null and !detail.watch.images.isEmpty() ? detail.watch.images[0].imageUrl : '/images/watches/default.jpg'}" 
                                                     th:alt="${detail.watch.watchName}">
                                                <div class="item-info">
                                                    <h4 th:text="${detail.watch.watchName}">Product Name</h4>
                                                    <p>Số lượng: <span th:text="${detail.quantity}">1</span></p>
                                                </div>
                                                <div class="item-price" th:text="${#numbers.formatDecimal(detail.price * detail.quantity, 0, 'COMMA', 0, 'POINT')} + ' ₫'">
                                                    800,000 ₫
                                                </div>
                                            </div>
                                        </div>

                                        <div class="order-footer">
                                            <div class="order-total">
                                                <span>Tổng tiền:</span>
                                                <strong th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + ' ₫'">2,400,000 ₫</strong>
                                            </div>
                                            <div class="order-actions">
                                                <a th:href="@{/orders/{id}(id=${order.orderId})}" class="btn btn-outline">Chi tiết</a>
                                                <button class="btn btn-primary" th:if="${order.orderStatus == 'DELIVERED'}">Đánh giá</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Empty State -->
                            <div class="empty-state" th:if="${orders == null or orders.isEmpty()}">
                                <i class="fas fa-box-open"></i>
                                <h3>Chưa có đơn hàng nào</h3>
                                <p>Bạn chưa có đơn hàng nào trong hệ thống</p>
                                <a href="/watches" class="btn btn-primary">Mua sắm ngay</a>
                            </div>
                        </div>

                        <!-- Profile Tab -->
                        <div class="tab-content" id="profile-tab">
                            <h2>THÔNG TIN CÁ NHÂN</h2>
                            
                            <form class="profile-form">
                                <div class="form-group">
                                    <label>Họ và tên</label>
                                    <input type="text" sec:authentication="principal.fullName" value="User Name">
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Email</label>
                                        <input type="email" sec:authentication="principal.username" value="user@email.com" readonly>
                                    </div>

                                    <div class="form-group">
                                        <label>Số điện thoại</label>
                                        <input type="tel" value="0912345678">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Ngày sinh</label>
                                    <input type="date">
                                </div>

                                <div class="form-group">
                                    <label>Giới tính</label>
                                    <div class="radio-group">
                                        <label><input type="radio" name="gender" value="male"> Nam</label>
                                        <label><input type="radio" name="gender" value="female"> Nữ</label>
                                        <label><input type="radio" name="gender" value="other"> Khác</label>
                                    </div>
                                </div>

                                <button type="submit" class="btn btn-primary">Cập nhật thông tin</button>
                            </form>
                        </div>

                        <!-- Change Password Tab -->
                        <div class="tab-content" id="password-tab">
                            <h2>ĐỔI MẬT KHẨU</h2>
                            
                            <form class="profile-form">
                                <div class="form-group">
                                    <label>Mật khẩu hiện tại</label>
                                    <input type="password" required>
                                </div>

                                <div class="form-group">
                                    <label>Mật khẩu mới</label>
                                    <input type="password" required>
                                </div>

                                <div class="form-group">
                                    <label>Xác nhận mật khẩu mới</label>
                                    <input type="password" required>
                                </div>

                                <button type="submit" class="btn btn-primary">Đổi mật khẩu</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        function switchToRegister() {
            document.querySelector('.auth-box').style.display = 'none';
            document.getElementById('registerBox').style.display = 'block';
        }

        function switchToLogin() {
            document.getElementById('registerBox').style.display = 'none';
            document.querySelector('.auth-box').style.display = 'block';
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.currentTarget.classList.add('active');
        }
    </script>
</body>
</html>
