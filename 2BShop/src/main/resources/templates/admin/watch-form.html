<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${watch.watchId != null ? 'Sửa Đồng Hồ' : 'Thêm Đồng Hồ Mới'}">Thêm Đồng Hồ - Admin</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="admin-body">
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="admin-logo">
                <i class="fas fa-crown"></i>
                <h2>2BShop Admin</h2>
            </div>
            
            <nav class="admin-nav">
                <a href="/admin" class="admin-nav-item">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
                <a href="/admin/watches" class="admin-nav-item active">
                    <i class="fas fa-clock"></i>
                    <span>Quản Lý Đồng Hồ</span>
                </a>
                <a href="/admin/orders" class="admin-nav-item">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Quản Lý Đơn Hàng</span>
                </a>
                <a href="/admin/users" class="admin-nav-item">
                    <i class="fas fa-users"></i>
                    <span>Quản Lý Users</span>
                </a>
                <a href="/admin/payments" class="admin-nav-item">
                    <i class="fas fa-credit-card"></i>
                    <span>Thanh Toán</span>
                </a>
                
                <div class="admin-nav-divider"></div>
                
                <a href="/" class="admin-nav-item">
                    <i class="fas fa-home"></i>
                    <span>Về Trang Chủ</span>
                </a>
                <a href="/logout" class="admin-nav-item">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Đăng Xuất</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <header class="admin-header">
                <div class="admin-header-left">
                    <button class="admin-mobile-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 th:text="${watch.watchId != null ? 'Sửa Đồng Hồ' : 'Thêm Đồng Hồ Mới'}">Thêm Đồng Hồ Mới</h1>
                </div>
                <div class="admin-header-right">
                    <a href="/admin/watches" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Quay Lại
                    </a>
                </div>
            </header>

            <!-- Form -->
            <div class="admin-section">
                <div class="watch-form-container">
                    <!-- Error/Success Messages -->
                    <div th:if="${error}" class="alert alert-danger">
                        <i class="fas fa-exclamation-circle"></i>
                        <span th:text="${error}"></span>
                    </div>
                    
                    <div th:if="${success}" class="alert alert-success">
                        <i class="fas fa-check-circle"></i>
                        <span th:text="${success}"></span>
                    </div>

                    <form th:action="${watch.watchId != null ? '/admin/watches/update/' + watch.watchId : '/admin/watches/create'}" 
                          method="post" 
                          enctype="multipart/form-data"
                          class="watch-form"
                          th:object="${watch}">
                        
                        <!-- Basic Info -->
                        <div class="form-section">
                            <h3 class="form-section-title">
                                <i class="fas fa-info-circle"></i> Thông Tin Cơ Bản
                            </h3>
                            
                            <div class="form-row-2col">
                                <div class="form-group">
                                    <label for="name">
                                        Tên Đồng Hồ <span class="required">*</span>
                                    </label>
                                    <input type="text" 
                                           id="name" 
                                           th:field="*{name}"
                                           class="form-control" 
                                           placeholder="Nhập tên đồng hồ"
                                           required>
                                    <small class="form-text">Ví dụ: Rolex Submariner Date 41mm</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="brand">
                                        Thương Hiệu <span class="required">*</span>
                                    </label>
                                    <input type="text" 
                                           id="brand" 
                                           th:field="*{brand}"
                                           class="form-control" 
                                           placeholder="Nhập thương hiệu"
                                           list="brandList"
                                           required>
                                    <datalist id="brandList">
                                        <option value="Rolex">
                                        <option value="Omega">
                                        <option value="Patek Philippe">
                                        <option value="Audemars Piguet">
                                        <option value="Cartier">
                                        <option value="TAG Heuer">
                                        <option value="IWC">
                                        <option value="Breitling">
                                    </datalist>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="description">
                                    Mô Tả <span class="required">*</span>
                                </label>
                                <textarea id="description" 
                                          th:field="*{description}"
                                          class="form-control" 
                                          rows="5"
                                          placeholder="Nhập mô tả chi tiết về đồng hồ..."
                                          required></textarea>
                                <small class="form-text">Mô tả chi tiết về sản phẩm, chất liệu, tính năng</small>
                            </div>
                        </div>

                        <!-- Price & Stock -->
                        <div class="form-section">
                            <h3 class="form-section-title">
                                <i class="fas fa-dollar-sign"></i> Giá & Tồn Kho
                            </h3>
                            
                            <div class="form-row-2col">
                                <div class="form-group">
                                    <label for="price">
                                        Giá Gốc (VNĐ) <span class="required">*</span>
                                    </label>
                                    <input type="number" 
                                           id="price" 
                                           th:field="*{price}"
                                           class="form-control" 
                                           placeholder="Nhập giá gốc"
                                           min="0"
                                           step="1000"
                                           required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="salePrice">
                                        Giá Sale (VNĐ)
                                    </label>
                                    <input type="number" 
                                           id="salePrice" 
                                           th:field="*{salePrice}"
                                           class="form-control" 
                                           placeholder="Nhập giá sale (nếu có)"
                                           min="0"
                                           step="1000">
                                    <small class="form-text">Để trống nếu không có sale</small>
                                </div>
                            </div>

                            <div class="form-row-2col">
                                <div class="form-group">
                                    <label for="stockQuantity">
                                        Số Lượng Tồn Kho <span class="required">*</span>
                                    </label>
                                    <input type="number" 
                                           id="stockQuantity" 
                                           th:field="*{stockQuantity}"
                                           class="form-control" 
                                           placeholder="Nhập số lượng"
                                           min="0"
                                           required>
                                    <small class="form-text stock-warning" th:if="${watch.stockQuantity != null && watch.stockQuantity == 0}">
                                        <i class="fas fa-exclamation-triangle"></i> 
                                        Hết hàng - sản phẩm sẽ có watermark và vô hiệu hóa nút mua
                                    </small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="category">
                                        Danh Mục
                                    </label>
                                    <select id="category" 
                                            th:field="*{category}"
                                            class="form-control">
                                        <option value="">-- Chọn danh mục --</option>
                                        <option value="NAM">Đồng Hồ Nam</option>
                                        <option value="NU">Đồng Hồ Nữ</option>
                                        <option value="THE_THAO">Đồng Hồ Thể Thao</option>
                                        <option value="CAO_CAP">Đồng Hồ Cao Cấp</option>
                                        <option value="THOI_TRANG">Đồng Hồ Thời Trang</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Specifications -->
                        <div class="form-section">
                            <h3 class="form-section-title">
                                <i class="fas fa-cog"></i> Thông Số Kỹ Thuật
                            </h3>
                            
                            <div class="form-row-2col">
                                <div class="form-group">
                                    <label for="dialSize">Kích Thước Mặt (mm)</label>
                                    <input type="number" 
                                           id="dialSize" 
                                           th:field="*{dialSize}"
                                           class="form-control" 
                                           placeholder="Ví dụ: 40"
                                           min="0"
                                           step="0.1">
                                </div>
                                
                                <div class="form-group">
                                    <label for="movement">Bộ Máy</label>
                                    <select id="movement" 
                                            th:field="*{movement}"
                                            class="form-control">
                                        <option value="">-- Chọn bộ máy --</option>
                                        <option value="AUTOMATIC">Automatic (Tự Động)</option>
                                        <option value="QUARTZ">Quartz (Pin)</option>
                                        <option value="MECHANICAL">Mechanical (Cơ)</option>
                                        <option value="SMARTWATCH">Smartwatch</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row-2col">
                                <div class="form-group">
                                    <label for="material">Chất Liệu</label>
                                    <input type="text" 
                                           id="material" 
                                           th:field="*{material}"
                                           class="form-control" 
                                           placeholder="Ví dụ: Thép không gỉ 316L">
                                </div>
                                
                                <div class="form-group">
                                    <label for="waterResistance">Chống Nước (ATM)</label>
                                    <input type="number" 
                                           id="waterResistance" 
                                           th:field="*{waterResistance}"
                                           class="form-control" 
                                           placeholder="Ví dụ: 30"
                                           min="0"
                                           step="1">
                                    <small class="form-text">1 ATM ≈ 10m</small>
                                </div>
                            </div>
                        </div>

                        <!-- Image Upload -->
                        <div class="form-section">
                            <h3 class="form-section-title">
                                <i class="fas fa-image"></i> Hình Ảnh Sản Phẩm
                            </h3>
                            
                            <div class="form-group">
                                <label for="imageFile">
                                    Upload Hình Ảnh <span class="required" th:if="${watch.watchId == null}">*</span>
                                </label>
                                <div class="image-upload-container">
                                    <div class="image-preview" id="imagePreview">
                                        <img th:if="${watch.imageUrl != null}" 
                                             th:src="@{/uploads/{img}(img=${watch.imageUrl})}" 
                                             alt="Preview"
                                             id="previewImg">
                                        <div class="upload-placeholder" th:if="${watch.imageUrl == null}">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                            <p>Click để chọn ảnh hoặc kéo thả vào đây</p>
                                            <small>JPG, PNG, WEBP (Max 5MB)</small>
                                        </div>
                                    </div>
                                    <input type="file" 
                                           id="imageFile" 
                                           name="imageFile"
                                           class="form-control file-input"
                                           accept="image/*"
                                           th:required="${watch.watchId == null}">
                                </div>
                                <small class="form-text">
                                    <i class="fas fa-info-circle"></i> 
                                    Ảnh sẽ được tự động resize về 800x800px để đảm bảo hiển thị đúng chuẩn
                                </small>
                            </div>
                        </div>

                        <!-- Submit Buttons -->
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-large">
                                <i class="fas fa-save"></i>
                                <span th:text="${watch.watchId != null ? 'Cập Nhật' : 'Thêm Mới'}">Thêm Mới</span>
                            </button>
                            <a href="/admin/watches" class="btn btn-secondary btn-large">
                                <i class="fas fa-times"></i> Hủy
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Image Preview
        const imageInput = document.getElementById('imageFile');
        const imagePreview = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');

        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (previewImg) {
                        previewImg.src = e.target.result;
                    } else {
                        imagePreview.innerHTML = `<img src="${e.target.result}" alt="Preview" id="previewImg">`;
                    }
                }
                reader.readAsDataURL(file);
            }
        });

        // Stock quantity warning
        const stockInput = document.getElementById('stockQuantity');
        stockInput.addEventListener('input', function() {
            const warningText = this.parentElement.querySelector('.stock-warning');
            if (this.value == 0) {
                if (!warningText) {
                    const warning = document.createElement('small');
                    warning.className = 'form-text stock-warning';
                    warning.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Hết hàng - sản phẩm sẽ có watermark và vô hiệu hóa nút mua';
                    this.parentElement.appendChild(warning);
                }
            } else {
                if (warningText) warningText.remove();
            }
        });

        // Mobile toggle
        document.querySelector('.admin-mobile-toggle')?.addEventListener('click', function() {
            document.querySelector('.admin-sidebar').classList.toggle('active');
        });

        // Validate sale price
        const priceInput = document.getElementById('price');
        const salePriceInput = document.getElementById('salePrice');
        
        salePriceInput.addEventListener('input', function() {
            const price = parseFloat(priceInput.value) || 0;
            const salePrice = parseFloat(this.value) || 0;
            
            if (salePrice > price && price > 0) {
                alert('Giá sale không được lớn hơn giá gốc!');
                this.value = '';
            }
        });
    </script>
</body>
</html>
